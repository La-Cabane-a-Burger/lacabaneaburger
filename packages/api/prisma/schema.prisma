generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgres"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  MANAGER
  ADMIN
}

enum Allergen {
  GLUTEN
  PEANUTS
  SOY
  SHELLFISH
  EGGS
  MILK
  NUTS
  SESAME
  WHEAT
  CORN
  SULFUR
  LUPIN
  MUSHROOMS
  CELERY
  MUSTARD
  MOLLUSCS
  TURKEY
  PORK
  CHICKEN
  FISH
}

enum Category {
    BURGER
    SALAD
    NUGGETS
    APPETIZER
    DESSERT
    SIDE
    BEVERAGE
}

model User {
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  createdAt     DateTime @default(now())
  email         String   @unique
  password      String
  role          Role     @default(USER)
  phone         String
  reward_points Int      @default(0)
  orders        Order[]
}

model Store {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  city        String
  slug        String    @unique
  phone       String
  postal_code Int
  address     String
  latitude    Float
  longitude   Float
  openings    Opening[]
  orders      Order[]
  items       Item[]
}

model Opening {
  id      String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  weekday String
  start   String
  end     String
  store   Store?  @relation(fields: [storeId], references: [id])
  storeId String? @db.Uuid
}

model Order {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  price      Float
  date       DateTime
  store      Store?      @relation(fields: [storeId], references: [id])
  storeId    String?     @db.Uuid
  user       User?       @relation(fields: [userId], references: [id])
  userId     String?     @db.Uuid
  orderItems OrderItem[]
}

model OrderItem {
  id          String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  order        Order         @relation(fields: [orderId], references: [id])
  orderId      String        @db.Uuid
  item         Item          @relation(fields: [itemId], references: [id])
  itemId       String        @db.Uuid
  orderRecipes OrderRecipe[]
  menu         Menu?         @relation(fields: [menuId], references: [id])
  menuId       String?       @db.Uuid
}

model OrderRecipe {
  orderItem    OrderItem  @relation(fields: [orderItemId], references: [id])
  orderItemId  String     @db.Uuid
  ingredient   Ingredient @relation(fields: [ingredientId], references: [id])
  ingredientId String    @db.Uuid

  @@id([orderItemId, ingredientId])
}

model Menu {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String      @unique
  price       Float
  category    String
  description String
  menuItems   Item[]
  orderMenus  OrderItem[]
  menuItem    MenuItem[]
}

model MenuItem {
  menu     Menu    @relation(fields: [menuId], references: [id])
  menuId   String @db.Uuid
  item     Item    @relation(fields: [itemId], references: [id])
  itemId   String @db.Uuid
  pickable Boolean @default(false)

  @@id([menuId, itemId])
}

model Item {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String      @unique
  price       Float
  category    Category
  description String?
  ingredients Recipe[]
  menuItems   Item[]      @relation("ItemToItem")
  orderItems  OrderItem[]
  menu        Menu?       @relation(fields: [menuId], references: [id])
  menuId      String?    @db.Uuid
  menuItem    MenuItem[]
  item        Item?       @relation("ItemToItem", fields: [itemId], references: [id])
  itemId      String?    @db.Uuid
  store   Store?  @relation(fields: [storeId], references: [id])
  storeId String? @db.Uuid
}

model Ingredient {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name         String        @unique
  price        Float         @default(0.0)
  category     String
  item         Recipe[]
  orderRecipes OrderRecipe[]
  allergens    Allergen[]
}

model Recipe {
  item         Item       @relation(fields: [itemId], references: [id])
  itemId       String    @db.Uuid
  ingredient   Ingredient @relation(fields: [ingredientId], references: [id])
  ingredientId String   @db.Uuid
  pickable     Boolean    @default(false)
  number       Int        @default(1)
  quantity     Float      @default(0)
  energy       Float      @default(0)

  @@id([itemId, ingredientId])
}
